(function(){function isPremiumLocal(){return localStorage.getItem('premium')==='true'};document.addEventListener('DOMContentLoaded',()=>{document.getElementById('btn-generate').addEventListener('click',async ()=>{if(!isPremiumLocal()){if(!confirm('Gerar relatório é Premium. Deseja ir para o checkout?')) return; window.location.href='https://buy.stripe.com/3cI14m6dsb3zbl14Br53O01'; return;} try{const res=await window.gerarRelatorioPDF({lang:'pt',styleMode:'both'}); if(res && res.blob){ const f=new FormData(); f.append('file', res.blob, res.filename); fetch('/api/upload-pdf',{method:'POST',body:f}).then(()=>alert('Relatório gerado e enviado')).catch(()=>alert('Relatório gerado (download)')); } }catch(e){alert('Erro: '+e.message)} }); document.getElementById('btn-send-welcome').addEventListener('click',()=>{const email=prompt('E-mail'); if(email) fetch('/api/send-email',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'welcome',email,nome:'Usuário Teste',app_url:window.location.origin})}).then(()=>alert('Enviado'));}); document.getElementById('btn-send-report').addEventListener('click',()=>{const email=prompt('E-mail'); if(email) fetch('/api/send-email',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'report',email,nome:'Usuário Teste',app_url:window.location.origin})}).then(()=>alert('Enviado'));}); document.getElementById('btn-send-remark').addEventListener('click',()=>{const email=prompt('E-mail'); if(email) fetch('/api/send-email',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'remarketing',email,nome:'Usuário Teste',app_url:window.location.origin})}).then(()=>alert('Enviado'));}); if('serviceWorker' in navigator) navigator.serviceWorker.register('/service-worker.js').catch(()=>{});});})();